var c1,c2,_CarType=[{ID:"1",Name:"武器"},{ID:"2",Name:"副手"},{ID:"3",Name:"盔甲"},{ID:"4",Name:"披風"},{ID:"5",Name:"鞋子"},{ID:"6",Name:"飾品"},{ID:"7",Name:"頭飾"}];function _init(){var e=$("#CardBlocks");c1=$("#C1"),c2=$("#C2");var n,t,a=JSON.parse(_CardData);$.each(_CarType,function(n,t){n+=1,e.append("<div id='block"+n+"' class='block'><div class='blockcaption'>"+t.Name+"</div><hr class='style1'></div>")}),$.each(a,function(a,o){n=e.find("div[id='block"+o.Type+"']"),t=$("<div class='col'><div><p class='caption'>"+o.Name+"</p></div></div>"),n.append(t),t.data("objCard",o)}),e.delegate(".col","click",function(){$(".overlay").show(),openChart($(this).data("objCard"))}),c2.find(".btnPanel").on("click",function(){$(".overlay").hide(),$(".ct-chart").empty(),enableScroll()})}function openChart(e){c2.find("span[id='TypeName']").text(getCarTypeName(e.Type)),c2.find("span[id='CardName']").text(e.Name);var n,t=[],a=[];if($.each(e.Price,function(e,o){(n=myParseInt(o))>0&&(t.push(n),a.push(_DataDate[e]))}),0==t.length)return $(".overlay").hide(),void alert("還沒有這張卡片的紀錄喔!");disableScroll();var o=t[0],r=t[0];$.each(t,function(e,n){n>o&&(o=n),n<r&&(r=n)}),c2.find(".latest").text(numberWithCommas(t[t.length-1])),c2.find(".hightest").text(numberWithCommas(o)),c2.find(".lowest").text(numberWithCommas(r));var i=Math.round((o+r)/2);new Chartist.Line(".ct-chart",{labels:a,series:[t]},{showArea:!0,width:"100%",height:500,axisY:{onlyInteger:!0,labelInterpolationFnc:function(e){return e/1e4+"萬"},offset:70},plugins:[Chartist.plugins.ctThreshold({threshold:i})]})}function getCarTypeName(e){return $.grep(_CarType,function(n,t){return n.ID==e})[0].Name}function myParseInt(e){var n=e;return n=n.replace(/,/g,""),parseInt(n,10)}function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}var keys={37:1,38:1,39:1,40:1};function preventDefault(e){(e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1}function preventDefaultForScrollKeys(e){if(keys[e.keyCode])return preventDefault(e),!1}function disableScroll(){window.addEventListener&&window.addEventListener("DOMMouseScroll",preventDefault,!1),window.onwheel=preventDefault,window.onmousewheel=document.onmousewheel=preventDefault,window.ontouchmove=preventDefault,document.onkeydown=preventDefaultForScrollKeys}function enableScroll(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null}