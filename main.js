var CB,C1,C2,Chart,_CarType=[{ID:"1",Name:"武器"},{ID:"2",Name:"副手"},{ID:"3",Name:"盔甲"},{ID:"4",Name:"披風"},{ID:"5",Name:"鞋子"},{ID:"6",Name:"飾品"},{ID:"7",Name:"頭飾"}];function _init(){CB=$("#CardBlocks"),C1=$("#C1"),C2=$("#C2"),Chart=$(".ct-chart");var a,t=JSON.parse(_CardData),e=$(".subtitle-block");$.each(_CarType,function(a,t){a+=1,e.append("<div id='block"+a+"' class='subtitle-link'>"+t.Name+"</div>")}),$.each(_CarType,function(a,t){a+=1,CB.append("<div id='block"+a+"' class='block'><div class='blockcaption'>"+t.Name+"</div><hr class='style1'></div>")}),$.each(t,function(t,i){switch(e=CB.find("div[id='block"+i.Type+"']"),i.Mob){case"1":a=$("<div class='col'><div class='MiniIcon'></div><div><p class='caption'>"+i.Name+"</p></div></div>");break;case"2":a=$("<div class='col'><div class='MVPIcon'></div><div><p class='caption'>"+i.Name+"</p></div></div>");break;default:a=$("<div class='col'><div><p class='caption'>"+i.Name+"</p></div></div>")}e.append(a),a.data("objCard",i)}),CB.delegate(".col","click",function(){openChart($(this).data("objCard"))}),C2.find(".btnPanel").on("click",function(){var a=Chart.data("type");C2.hide(),C1.show(),Chart.empty();var t=$("div[class='block'][id='block"+a+"']").offset().top;window.scrollTo(0,t-10)}),C1.find(".subtitle-link").on("click",function(){var a=$(this).attr("id"),t=$("div[class='block'][id='"+a+"']").offset().top;window.scrollTo(0,t)}),$(".gototop-text").on("click",function(){window.scrollTo(0,0)})}function openChart(a){var t,e=[],i=[];if($.each(a.Price,function(a,n){(t=myParseInt(n))>0&&(e.push(t),i.push(_DataDate[a]))}),0!=e.length){C1.hide(),C2.show(),window.scrollTo(0,top),C2.find("span[id='TypeName']").text(getCarTypeName(a.Type)),C2.find("span[id='CardName']").text(a.Name);var n=e[0],o=e[0];$.each(e,function(a,t){t>n&&(n=t),t<o&&(o=t)}),C2.find(".latest").text(numberWithCommas(e[e.length-1])),C2.find(".hightest").text(numberWithCommas(n)),C2.find(".lowest").text(numberWithCommas(o));var c=Math.round((n+o)/2);Chart.data("type",a.Type),new Chartist.Line(".ct-chart",{labels:i,series:[e]},{showArea:!0,width:"100%",height:400,axisY:{onlyInteger:!0,labelInterpolationFnc:function(a){return a/1e4+"萬"},offset:70},plugins:[Chartist.plugins.ctThreshold({threshold:c})]})}else alert("還沒有這張卡片的紀錄喔!")}function getCarTypeName(a){return $.grep(_CarType,function(t,e){return t.ID==a})[0].Name}function myParseInt(a){var t=a;return t=t.replace(/,/g,""),parseInt(t,10)}function numberWithCommas(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}