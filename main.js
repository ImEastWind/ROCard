var CB,C1,C2,Chart,_CarType=[{ID:"1",Name:"武器"},{ID:"2",Name:"副手"},{ID:"3",Name:"盔甲"},{ID:"4",Name:"披風"},{ID:"5",Name:"鞋子"},{ID:"6",Name:"飾品"},{ID:"7",Name:"頭飾"}];function _init(){CB=$("#CardBlocks"),C1=$("#C1"),C2=$("#C2"),Chart=$(".ct-chart");var t,e=JSON.parse(_CardData),a=$(".subtitle-block");$.each(_CarType,function(t,e){t+=1,a.append("<div id='block"+t+"' class='subtitle-link'>"+e.Name+"</div>")}),$.each(_CarType,function(t,e){t+=1,CB.append("<div id='block"+t+"' class='block'><div class='blockcaption'>"+e.Name+"</div><hr class='style1'></div>")}),$.each(e,function(e,n){a=CB.find("div[id='block"+n.Type+"']"),t=$("<div class='col'><div><p class='caption'>"+n.Name+"</p></div></div>"),a.append(t),t.data("objCard",n)}),CB.delegate(".col","click",function(){openChart($(this).data("objCard"))}),C2.find(".btnPanel").on("click",function(){var t=Chart.data("type");C2.hide(),C1.show(),Chart.empty();var e=$("div[class='block'][id='block"+t+"']").offset().top;window.scrollTo(0,e-10)}),C1.find(".subtitle-link").on("click",function(){var t=$(this).attr("id"),e=$("div[class='block'][id='"+t+"']").offset().top;window.scrollTo(0,e)}),$(".gototop-text").on("click",function(){window.scrollTo(0,0)})}function openChart(t){var e,a=[],n=[];if($.each(t.Price,function(t,i){(e=myParseInt(i))>0&&(a.push(e),n.push(_DataDate[t]))}),0!=a.length){C1.hide(),C2.show(),window.scrollTo(0,top),C2.find("span[id='TypeName']").text(getCarTypeName(t.Type)),C2.find("span[id='CardName']").text(t.Name);var i=a[0],o=a[0];$.each(a,function(t,e){e>i&&(i=e),e<o&&(o=e)}),C2.find(".latest").text(numberWithCommas(a[a.length-1])),C2.find(".hightest").text(numberWithCommas(i)),C2.find(".lowest").text(numberWithCommas(o));var r=Math.round((i+o)/2);Chart.data("type",t.Type),new Chartist.Line(".ct-chart",{labels:n,series:[a]},{showArea:!0,width:"100%",height:400,axisY:{onlyInteger:!0,labelInterpolationFnc:function(t){return t/1e4+"萬"},offset:70},plugins:[Chartist.plugins.ctThreshold({threshold:r})]})}else alert("還沒有這張卡片的紀錄喔!")}function getCarTypeName(t){return $.grep(_CarType,function(e,a){return e.ID==t})[0].Name}function myParseInt(t){var e=t;return e=e.replace(/,/g,""),parseInt(e,10)}function numberWithCommas(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}